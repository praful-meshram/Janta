/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.42
 * Generated at: 2014-01-29 04:48:28 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import java.sql.*;
import javax.naming.*;
import javax.sql.*;
import java.io.*;
import java.text.*;
import java.lang.*;

public final class custOrderSummDetails_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\t\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "sessionBoth.jsp" + (("sessionBoth.jsp").indexOf('?')>0? '&': '?') + org.apache.jasper.runtime.JspRuntimeLibrary.URLEncode("formName", request.getCharacterEncoding())+ "=" + org.apache.jasper.runtime.JspRuntimeLibrary.URLEncode("custOrderSummDetails.jsp", request.getCharacterEncoding()), out, false);
      out.write('\n');
      out.write('\n');
      out.write('\n');
	
  	String custCode="";
  	custCode=request.getParameter("hcuscode");  
  	if(!custCode.equals("CC")){
  		
		  	customer.ManageCustomer c;
			c = new customer.ManageCustomer("jdbc/js");
			c.customerInfo(custCode); 
			String name="",phno="";
			String building="",buildingNo="";
			String block="",wing="",area="";
			String add1="",add2="",station="";		
			String last_order_date="";
			
			int last_order_num=0;
			int tot_orders_3=0;
			int tot_orders_6=0;
			int tot_orders_12=0;
			int avg_items_3=0;
			int avg_items_6=0;
			int avg_items_12=0;
			
			float fmcg_per_3=0.0f;
			float fmcg_per_6=0.0f;
			float fmcg_per_12=0.0f;
			float tot_savings_3=0.0f;
			float tot_savings_6=0.0f;
			float tot_savings_12=0.0f;
			float tot_value_3=0.0f;
			float tot_value_6=0.0f;
			float tot_value_12=0.0f;
		
			while(c.rs.next()){
				int i=1;
				  
				name=c.rs.getString(i++);
				phno=c.rs.getString(i++);
				custCode=c.rs.getString(i++);
				building=c.rs.getString(i++);
				buildingNo=c.rs.getString(i++);
				block=c.rs.getString(i++);
				wing=c.rs.getString(i++);
				area=c.rs.getString(i++);
				add1=c.rs.getString(i++);
				add2=c.rs.getString(i++);
				station=c.rs.getString(i++);
				fmcg_per_3=c.rs.getFloat(i++);
				last_order_date=c.rs.getString(i++);
				last_order_num=c.rs.getInt(i++);
				
				fmcg_per_6=c.rs.getFloat(i++);
				fmcg_per_12=c.rs.getFloat(i++);
				
				tot_orders_3=c.rs.getInt(i++);
				tot_orders_6=c.rs.getInt(i++);
				tot_orders_12=c.rs.getInt(i++);
				
				tot_savings_3=c.rs.getFloat(i++);
				tot_savings_6=c.rs.getFloat(i++);
				tot_savings_12=c.rs.getFloat(i++);
				
				tot_value_3=c.rs.getFloat(i++);
				tot_value_6=c.rs.getFloat(i++);
				tot_value_12=c.rs.getFloat(i++);
				
				avg_items_3=c.rs.getInt(i++);
				avg_items_6=c.rs.getInt(i++);
				avg_items_12=c.rs.getInt(i++);
						
			}
		  	
			c.closeAll();
		
      out.write("  \n");
      out.write("\t\t\n");
      out.write("\t\t\t\n");
      out.write("\t\t\n");
      out.write("\t\t\t\n");
      out.write("\t\t\t\n");
      out.write("\t\t\t\n");
      out.write("\t\t\t<table width=\"40%\" class=\"item3\"  border=\"1\" style=\"background-color:#FFE4C4\">\n");
      out.write("\t\t\t\n");
      out.write("\t\t\t<tr>\n");
      out.write("\t\t\t\t<td>\n");
      out.write("\t\t\t<table id=\"1\" border=\"0\" align=\"left\" width=\"300\">\n");
      out.write("\t\t\t\n");
      out.write("\t\t\t<tr><th colspan=\"6\"><center><b>Customer Information</b></center> </th></tr>\n");
      out.write("\t\t\t<tr></tr><TR></TR>\n");
      out.write("\t\t\t<tr></tr><TR></TR>\n");
      out.write("\t\t\t<tr></tr><TR></TR>\n");
      out.write("\t\t\t<tr>\t\t\n");
      out.write("\t\t\t\t<td> <b>Code&nbsp;&nbsp;&nbsp;&nbsp;: </b>");
      out.print(custCode);
      out.write("</td>\t\n");
      out.write("\t\t\t</tr>\n");
      out.write("\t\t\t<tr>\t\t\n");
      out.write("\t\t\t\t<td> <b>Name &nbsp;&nbsp;&nbsp;: </b> ");
      out.print(name);
      out.write(" </td>\t\n");
      out.write("\t\t\t</tr>\n");
      out.write("\t\t\t<tr>\t\t\n");
      out.write("\t\t\t\t<td><b>Address&nbsp;: </b>");
      out.print(buildingNo);
      out.write(',');
      out.write(' ');
      out.print(block);
      out.write(',');
      out.write(' ');
      out.print(wing);
      out.write(',');
      out.write(' ');
      out.print(building);
      out.write(',');
      out.write(' ');
      out.print(area);
      out.write("</td>\t\t\n");
      out.write("\t\t\t</tr>\n");
      out.write("\t\t\t<tr>\t\t\n");
      out.write("\t\t\t\t<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ");
      out.print(add1);
      out.write(' ');
      out.write(',');
      out.print(add2);
      out.write(',');
      out.write(' ');
      out.print(station);
      out.write("</td>\t\t\n");
      out.write("\t\t\t</tr>\n");
      out.write("\t\t\t<tr>\t\t\n");
      out.write("\t\t\t\t<td><b>Phone &nbsp;&nbsp;:</b>");
      out.print(phno);
      out.write("</td>\t\t\n");
      out.write("\t\t\t</tr>\n");
      out.write("\t\t\t</table></td>\t\n");
      out.write("\t\t\t<td>\n");
      out.write("\t\t\t<table  border=\"1\" align=\"left\"  width=\"200\">\n");
      out.write("\t\t\t<tr><th colspan=\"4\"><center><b>Purchase Pattern</b></center> </th></tr>\n");
      out.write("\t\t\t\t<tr>\n");
      out.write("\t\t\t\t\t\n");
      out.write("\t\t\t\t\t<td></td>\n");
      out.write("\t\t\t\t\t<td><b>3M</b></td>\n");
      out.write("\t\t\t\t\t<td><b>6M</b></td>\n");
      out.write("\t\t\t\t\t<td><b>12M</b></td>\n");
      out.write("\t\t\t\t</tr>\t\n");
      out.write("\t\t\t\t<tr>\n");
      out.write("\t\t\t\t\t<td><b>Orders</b></td>\n");
      out.write("\t\t\t\t\t<td align=\"right\">");
      out.print(tot_orders_3);
      out.write("</td>\t\n");
      out.write("\t\t\t\t\t<td align=\"right\">");
      out.print(tot_orders_6);
      out.write("</td>\t\n");
      out.write("\t\t\t\t\t<td align=\"right\">");
      out.print(tot_orders_12);
      out.write("</td>\t\n");
      out.write("\t\t\t\t</tr>\n");
      out.write("\t\t\t\t<tr>\n");
      out.write("\t\t\t\t\t<td><b>FMCG (%)</b></td>\n");
      out.write("\t\t\t\t\t<td align=\"right\">");
      out.print(fmcg_per_3);
      out.write("</td>\n");
      out.write("\t\t\t\t\t<td align=\"right\">");
      out.print(fmcg_per_6);
      out.write("</td>\n");
      out.write("\t\t\t\t\t<td align=\"right\">");
      out.print(fmcg_per_12);
      out.write("</td>\t\n");
      out.write("\t\t\t\t</tr>\n");
      out.write("\t\t\t\t<tr>\n");
      out.write("\t\t\t\t\t<td><b>Value</b></td>\n");
      out.write("\t\t\t\t\t<td align=\"right\">");
      out.print(tot_value_3);
      out.write("</td>\n");
      out.write("\t\t\t\t\t<td align=\"right\">");
      out.print(tot_value_6);
      out.write("</td>\n");
      out.write("\t\t\t\t\t<td align=\"right\">");
      out.print(tot_value_12);
      out.write("</td>\n");
      out.write("\t\t\t\t</tr>\t\n");
      out.write("\t\t\t\t<tr>\n");
      out.write("\t\t\t\t\t<td><b>Savings</b></td>\n");
      out.write("\t\t\t\t\t<td align=\"right\">");
      out.print(tot_savings_3);
      out.write("</td>\n");
      out.write("\t\t\t\t\t<td align=\"right\">");
      out.print(tot_savings_6);
      out.write("</td>\n");
      out.write("\t\t\t\t\t<td align=\"right\">");
      out.print(tot_savings_12);
      out.write("</td>\n");
      out.write("\t\t\t\t</tr>\n");
      out.write("\t\t\t\t<tr>\n");
      out.write("\t\t\t\t\t<td><b>AVG Items</b></td>\n");
      out.write("\t\t\t\t\t<td align=\"right\">");
      out.print(avg_items_3);
      out.write("</td>\n");
      out.write("\t\t\t\t\t<td align=\"right\">");
      out.print(avg_items_6);
      out.write("</td>\n");
      out.write("\t\t\t\t\t<td align=\"right\">");
      out.print(avg_items_12);
      out.write("</td>\n");
      out.write("\t\t\t\t</tr>\t\n");
      out.write("\t\t \t</table> \t\n");
      out.write("\t\t \t</td></tr></table>\n");
      out.write("\t\t \t\n");
      out.write("\t\t \t<br><BR><BR>\n");
      out.write("\t\t \t\n");
      out.write("\t\t \t");

					DecimalFormat df = new DecimalFormat("###,###.00");
					DecimalFormat dfQty = new DecimalFormat("0.000");
					DecimalFormat dfQty1 = new DecimalFormat("0");
					//System.out.println("last_order_num: "+last_order_num);	
					if(last_order_num!=0){
						
						String orderDate="";				
						int totalItems=0;
						long item_taken=0;				
						float totalValue=0.0f;			
						
						float itemRate=0.0f;
						float itemQty=0.0f;
						float itemTotPrice=0.0f;
						float itemMRP=0.0f;
						float totalValueMRP=0.0f;
						float savings=0.0f;
						float totalValueDis=0.0f;
						float itemTotDis=0.0f;
						float comm_amt=0.0f;
						float tot_comm=0.0f;
						
						String itemName="";
						String itemWeight="";				
						String p_type="";
						String disRemark="";
		        	    int i=0;
		        	    
		        	    String query="";
					Connection conn=null;
					Statement stat=null;	
					ResultSet rs=null;
				try{	
					Context initContext = new InitialContext();
					Context envContext  = (Context)initContext.lookup("java:/comp/env");
					DataSource ds = (DataSource)envContext.lookup("jdbc/js");
					conn = ds.getConnection();
					stat=conn.createStatement();		
					
		
					query="select a.total_items, a.total_value, " +					
							"b.rate, b.qty, b.price, b.mrp, b.item_discount, b.remark,b.item_taken, e.payment_type_desc, " + 
						  	"d.item_name, d.item_weight, d.comm_amt, a.order_num, a.order_date " +				  	
							"from orders a, order_detail b, item_master d ,payment_type e " +
							"where a.order_num = b.order_num " +					
							"and b.item_code = d.item_code " +
							"and a.payment_type_code = e.payment_type_code "+
							"and a.order_num = (SELECT max(order_num) FROM orders where custcode = '"+custCode+"') "+
							"order by b.entry_no";
							
						System.out.println("order list: "+query);						
						rs=stat.executeQuery(query);		
						int ctr = 0, j=0, itemCount=0;
					while(rs.next()) {
					    
						i=1;				
						totalItems=rs.getInt(i++);
						totalValue=rs.getFloat(i++);
						
						itemRate=rs.getFloat(i++);
						itemQty=rs.getFloat(i++);
							
						itemTotPrice=rs.getFloat(i++);
						itemMRP=rs.getFloat(i++);
						itemTotDis=rs.getFloat(i++);
						disRemark=rs.getString(i++);
						item_taken=rs.getLong(i++);			
						p_type=rs.getString(i++);
						
						itemName=rs.getString(i++);
						itemWeight=rs.getString(i++);
						comm_amt=rs.getFloat(i++);	
						last_order_num = rs.getInt(i++);
						last_order_date = rs.getString(i++);
						tot_comm = tot_comm + (itemQty * comm_amt);				
			if (ctr==0) {			
			
      out.write("\t\n");
      out.write("\t\t\t<table align=\"left\" width=\"75%\" border=\"1\" class=\"item3\" style=\"background-color:#FFE4C4\">\t\n");
      out.write("\t\t\t\n");
      out.write("\t\t\t<th colspan=4><center>Last Order Details</center></th>\n");
      out.write("\t\t\t<th>Order No. : ");
      out.print(last_order_num);
      out.write(" </th>\n");
      out.write("\t\t\t<th colspan=3>Order Date. : ");
      out.print(last_order_date);
      out.write(" </th>\t\t\n");
      out.write("\t\t\t<tr>\n");
      out.write("\t\t\t\t\t<td ><b>Item</b></td>\n");
      out.write("\t\t\t\t\t<td ><b>Rate</b></td>\t\t\n");
      out.write("\t\t\t\t\t<td><b>Weight</b></td>\t\t\t\n");
      out.write("\t\t\t\t\t<td><b>Qty</b></td>\n");
      out.write("\t\t\t\t\t<td colspan=\"2\"><b><center>Price</center></b></td>\n");
      out.write("\t\t\t\t\t<td colspan=\"2\"><b><center>Deals</center></b></td>\n");
      out.write("\t\t\t\t\t\n");
      out.write("\t\t\t\t</tr>\n");
      out.write("\t\t\t\t\n");
      out.write("\t\t\t\t<tr>\n");
      out.write("\t\t\t\t\t<td colspan=4>&nbsp;</td>\n");
      out.write("\t\t\t\t\t<td><b>Janta's Price</b></td>\n");
      out.write("\t\t\t\t\t<td ><b>MRP</b></td>\n");
      out.write("\t\t\t\t\t<td><b>Discount</b></td>\n");
      out.write("\t\t\t\t\t<td><b>Remark</b></td>\t\t\n");
      out.write("\t\t\t\t\t\n");
      out.write("\t\t\t\t</tr>\n");
      out.write("\t\t\t\t\n");
 				ctr = ctr + 1; 
			} 
				savings = itemMRP - itemTotPrice;
				if(savings<0)
					savings=0.0f;			

      out.write("\n");
      out.write("\t\t\t\n");
      out.write("\t\t<tr>\n");
      out.write("\t\t\t<td width='15%' align=left>");
      out.print(itemName);
      out.write("</td>\n");
      out.write("\t\t\t<td  width='10%' align=right>");
      out.print(itemRate);
      out.write("</td>\t\n");
      out.write("\t\t\t<td width='10%' valign=top>");
      out.print(itemWeight);
      out.write("</td>\t\n");
      out.write("\t\t\t<td width='6%' valign=top>");
      out.print(dfQty1.format(itemQty));
      out.write("</td>\n");
      out.write("\t\t\t\t\t\n");
      out.write("\t\t\t<td width='8%' valign=top align=right>");
      out.print(itemTotPrice);
      out.write("</td>\n");
      out.write("\t\t\t");
 if(itemMRP<=0) { 
      out.write("\n");
      out.write("\t\t\t<td width='8%' valign=top align=right>NA</td>\n");
      out.write("\t\t\t");
 } else { 
      out.write("\n");
      out.write("\t\t\t<td width='8%' valign=top align=right>");
      out.print(df.format(itemMRP));
      out.write("</td>\n");
      out.write("\t\t\t");
}
      out.write("\n");
      out.write("\t\t\t<td align='right' width='6%'>");
      out.print( df.format(savings));
      out.write("/-</td>\n");
      out.write("\t\t\t<td width='6%'>");
      out.print(disRemark);
      out.write("</td></tr>\n");
      out.write("\t\t\n");
      out.write("\t\t");
		}
			long item_deliver = totalItems-item_taken;
			if (ctr!=0) {	
		
      out.write("\n");
      out.write("\t\t\n");
      out.write("\t\t\t<tr>\n");
      out.write("\t\t\t\n");
      out.write("\t\t\t\t\t<th> <div id='totalSel' align=\"left\"><b>Total items:  ");
      out.print(totalItems);
      out.write(" <br>\n");
      out.write("\t\t\t\t\t Pickup: ");
      out.print(item_taken);
      out.write("  <br> Deliver: ");
      out.print(item_deliver);
      out.write(" </b></div></th>\n");
      out.write("\t\t\t\t\t<th><b>Payment : ");
      out.print(p_type);
      out.write("</b></th><th></th><th></th>\n");
      out.write("\t\t\t\t\t<th align=right><div id='totalValue' align=\"right\"><b>Total: ");
      out.print(totalValue);
      out.write("</b></th>\n");
      out.write("\t\t\t\t\t<th align=left colspan=2><div id='totalComm' align=\"right\">Commission: ");
      out.print(tot_comm);
      out.write("</b></th>\n");
      out.write("\t\t\t\t\t<input type=\"hidden\" name=\"comm\" value=\"");
      out.print(tot_comm);
      out.write("\">\n");
      out.write("\t\t\t\t</tr>\n");
      out.write("\t\t");

			}
				rs.close();
				stat.close();
				conn.close();
			}catch(Exception e)
			{
				System.out.println(e);
				rs.close();
				stat.close();
				conn.close();
			}
		}
}

      out.write("\n");
      out.write("</table>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
